# render.yaml - Fichier de déploiement pour Render.com
services:
  # Service API Backend
  - type: web
    name: djulah-backend
    env: node
    plan: free
    buildCommand: cd backend && npm install
    startCommand: cd backend && npm start
    healthCheckPath: /health
    envVars:
      # Variables d'environnement de base
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000

      # Base de données MongoDB
      - key: MONGODB_URI
        value: "mongodb+srv://cesaristos5:D5NfqTbJGXpybjqL@k2ngrouptest.8xgdo.mongodb.net/djulah?retryWrites=true&w=majority&appName=k2ngrouptest&serverSelectionTimeoutMS=30000&connectTimeoutMS=30000&maxPoolSize=10&socketTimeoutMS=30000"

      # JWT
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 7d

      # Email (Resend recommandé)
      - key: RESEND_API_KEY
        sync: false # À configurer manuellement
      - key: EMAIL_FROM
        value: onboarding@resend.dev

      # Configuration SMTP pour l'envoi d'emails
      - key: SMTP_USER
        value: "cesaristos85@gmail.com"
      - key: SMTP_PASS
        value: "ybfm tkhc pyaa bmuy"

      # URL du client
      - key: CLIENT_URL
        sync: false # À configurer avec l'URL du frontend

      # Cloudinary (optionnel)
      - key: CLOUDINARY_CLOUD_NAME
        value: dvtmnepbx
      - key: CLOUDINARY_API_KEY
        value: 254785473634652
      - key: CLOUDINARY_API_SECRET
        value: B9OInOlWjPB1r-U1PUhlmzr8sF0

    # Configuration du service
    autoDeploy: true
    healthCheck:
      path: /health
      checkInterval: 30
      timeoutSeconds: 10
      gracePeriodSeconds: 60

    # Configuration de construction
    buildContext: backend
    nodeVersion: 18

    # Configuration du runtime
    runtime: node
    region: oregon

    # Configuration du domaine
    domains:
      - djulah-backend.onrender.com

# Configuration des bases de données (désactivée - utilisation base externe)
# databases:
#   # Base de données MongoDB pour Djulah
#   - name: djulah-mongodb
#     databaseName: djulah
#     user: djulah_user
#     plan: free
#     region: oregon
#     ipAllowList: []  # Restreindre l'accès si nécessaire
